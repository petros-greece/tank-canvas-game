<!DOCTYPE html>
<html lang="el">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tank Rotated 90 Degrees Right</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #e0e0e0;
    }

    canvas {
      background-color: #ffffff;
    }
  </style>
</head>

<body>
  <canvas id="tankCanvas" width="700" height="700"></canvas>

  <script>
    // Λήψη του canvas και του context
    const canvas = document.getElementById("tankCanvas");
    const ctx = canvas.getContext("2d");

    game = {
      //frame: 0
    }

    /////////////////////////////////////////////////////////

    function Tank(ctx, options = {}) {
      this.ctx = ctx;

      // Set up position with default values
      this.position = this.position || {};
      this.position.x = options.position?.x ?? 50;  // Default x position
      this.position.y = options.position?.y ?? 130; // Default y position

      // Assign other tank properties with option values or defaults
      this.bodyFillStyle = options.bodyFillStyle ?? "#4c8c4a";
      this.towerFillStyle = options.towerFillStyle ?? "#3e6d3b";
      this.canonFillStyle = options.canonFillStyle ?? "#2b4b29";
      this.wheelsFillStyle = options.wheelsFillStyle ?? "red";
      this.wheelTracksFillStyle = options.wheelTracksFillStyle ?? "yellow";

      // Assign defaults for size, speed, angles, and other parameters
      this.wheelTracksLineNum = options.wheelTracksLineNum ?? 10;
      this.size = options.size ?? 30;
      this.speed = options.speed ?? 1;
      this.angle = options.angle ?? 10;
      this.cannonAngle = options.cannonAngle ?? 33;
      this.frame = 0;

      // Component object for calculations or stored dimensions
      this.comp = {};
    }

    Tank.prototype.init = function () {
      this.comp.fullSize = 14 * this.size;
      this.comp.halfSize = 7 * this.size;
      this.comp.isLockedDir = false;
      this.comp.lineDist = (this.comp.fullSize) / this.wheelTracksLineNum;
      this.frame = Math.floor(Math.random() * this.comp.lineDist);
    }

    Tank.prototype.render = function () {

      const size = this.size;
      const ctx = this.ctx;

      // Draw tank body
      ctx.fillStyle = this.bodyFillStyle;
      ctx.fillRect(-this.comp.halfSize, -3.5 * size, this.comp.fullSize, this.comp.halfSize);

      // Draw tank tower
      ctx.fillStyle = this.towerFillStyle;
      ctx.beginPath();
      ctx.arc(0, 0, 2 * size, 0, Math.PI * 2);
      ctx.fill();

      // Draw tracks
      this.renderTracks(ctx, this.size);

      // Draw cannon
      this.renderCannon(ctx, this.size);

    }

    Tank.prototype.move = function () {
      const ctx = this.ctx;
      ctx.save();
      ctx.translate(this.position.x, this.position.y);
      ctx.rotate(this.angle * (Math.PI / 180));
      this.render();
      ctx.restore();
      // Update the tank's position based on angle
      this.position.x += Math.cos(this.angle * (Math.PI / 180)) * this.speed;
      this.position.y += Math.sin(this.angle * (Math.PI / 180)) * this.speed;
      this.frame += 1;
    }

    Tank.prototype.renderCannon = function (ctx, size) {
      ctx.save();
      ctx.rotate(this.cannonAngle * (Math.PI / 180));
      ctx.fillStyle = this.canonFilleStyle;
      ctx.fillRect(2 * this.size, -0.5 * this.size, 6 * this.size, this.size);
      ctx.restore();
    }

    Tank.prototype.renderTracks = function(ctx, size){
      // Draw tracks
      ctx.fillStyle = this.wheelTracksFillStyle;
      ctx.fillRect(-this.comp.halfSize, -5.5 * size, this.comp.fullSize, 2 * size); // Upper track
      ctx.fillRect(-this.comp.halfSize, 3.5 * size, this.comp.fullSize, 2 * size); // Lower track

      // Draw wheels lines
      ctx.fillStyle = this.wheelsFillStyle;
      const lineDist = this.comp.lineDist;
      const frame = this.frame % lineDist;

      ctx.beginPath();
      for (let i = 0; i < this.wheelTracksLineNum; i++) {
        ctx.moveTo(-this.comp.halfSize + (i * lineDist + frame), -3.5 * size);
        ctx.lineTo(-this.comp.halfSize + (i * lineDist + frame), -5.5 * size);
        ctx.moveTo(-this.comp.halfSize + (i * lineDist + frame), 3.5 * size);
        ctx.lineTo(-this.comp.halfSize + (i * lineDist + frame), 5.5 * size);
      }
      ctx.stroke();
    }

    Tank.prototype.moveTo = function (targetX, targetY) {
  // Calculate the angle to the target point
  const dx = targetX - this.position.x;
  const dy = targetY - this.position.y;
  const targetAngle = Math.atan2(dy, dx) * (180 / Math.PI); // Convert to degrees
  const distance = Math.sqrt(dx * dx + dy * dy);

  // Determine shortest rotation direction
  const angleDifference = (targetAngle - this.angle + 360) % 360;
  const rotationSpeed = 2; // Adjust rotation speed for smoother rotation
  
  if (distance > this.speed*2) {
    // Rotate the tank towards the target angle gradually
    if (angleDifference > 0 && angleDifference < 180) {
      this.angle += Math.min(rotationSpeed, angleDifference); // Rotate clockwise
    } else if (angleDifference >= 180) {
      this.angle -= Math.min(rotationSpeed, 360 - angleDifference); // Rotate counterclockwise
    }

    // Move forward in the current angle direction
    const moveSpeed = Math.min(this.speed, distance); // Reduce speed if close to target
    this.position.x += Math.cos(this.angle * (Math.PI / 180)) * moveSpeed;
    this.position.y += Math.sin(this.angle * (Math.PI / 180)) * moveSpeed;

  } else {
    // Snap to target if close enough
    this.position.x = targetX;
    this.position.y = targetY;
  }

  // Draw tank with the updated position and angle
  const ctx = this.ctx;
  ctx.save();
  ctx.translate(this.position.x, this.position.y);
  ctx.rotate(this.angle * (Math.PI / 180));
  this.render();
  ctx.restore();
};



    /////////////////////////////////////////////////////////////

    options = {
      position: { x: 25, y: 15 },
      bodyFillStyle: "#4c8c4a",
      towerFillStyle: "#3e6d3b",
      canonFilleStyle: "#2b4b29",
      wheelsFillStyle: "red",
      wheelTracksFillStyle: "yellow",
      wheelLineNum: 5,
      size: 5,
      speed: 1,
      frame: 0

    }

    let tanks = [];

    for (let i = 0; i < 1; i += 1) {
      //debugger;
      let tank = new Tank(ctx, options);
      options.position.y += 130;
      tank.init();
      tanks.push(tank);
    }

    x = 400;
    y = 400;

    setInterval(function () {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      tanks.forEach((t) => {
        t.moveTo(x,y);
      });
    }, 10);


    canvas.addEventListener('click', (event) => {
      const rect = canvas.getBoundingClientRect();
      const mouseX = event.clientX - rect.left;
      const mouseY = event.clientY - rect.top;

      x = mouseX, y = mouseY;

     // alert({ x: mouseX, y: mouseY });
    });

  </script>
</body>

</html>