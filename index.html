<!DOCTYPE html>
<html lang="el">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tank Rotated 90 Degrees Right</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #e0e0e0;
    }

    canvas {
      background-color: #ffffff;
    }
  </style>
</head>

<body>
  <canvas id="tankCanvas" width="700" height="700"></canvas>


  <button id="shoot">shoot</button>

  <script src="scripts/helpers.js"></script>

  <script src="scripts/WorldBuilder.js"></script>
  <script src="scripts/Missile.js"></script>
  <script src="scripts/Tank.js"></script>
  <script src="scripts/Objects.js"></script>
  <script src="scripts/Game.js"></script>

  <script>
    // Λήψη του canvas και του context
    const canvas = document.getElementById("tankCanvas");
    const ctx = canvas.getContext("2d");

    let gameOptions = {
      worldBuilders: [
        {
          builderOpts: {
            num: 14,
            dx: 60,
            dy: 23,
            sx: 0,
            sy: 0,
            sa: 0
          },
          objectOpts: {
            height: 50,
            width: 50,
            position: { x: 20, y: 20 }
          }
        }
      ],
      tankOpts: [
        {
          position: { x: 325, y: 275 },
          moveToPos: { x: 325, y: 275 },
          wheelLineNum: 2,
          size: 8,
          speed: 1,
          frame: 0,
          cannonAngle: 0,
          bodyFill: 'red',
          id: 0,
          team: 'Warriors'
        }
      ]

    }










    let game = new Game(canvas, gameOptions);
    game.attachEvents();

    game.run();

    /************
        
        let game = {
          missiles: [],
          objects: [],
          enemyTanks: []
          //frame: 0
        }
    
        myTeam = 1;
        selectedTankIndex = -1;
        let tanks = [];
    
        game.objects.push(
          new GameObject(ctx, { angle: 50, position: { x: 230, y: 120 }, width: 50, height: 50 })
        );
    
        /////////////////////////////////////////////////////////////
    
        options = {
          position: { x: 325, y: 215 },
          moveToPos: { x: 325, y: 215 },
          wheelLineNum: 2,
          size: 5,
          speed: 1,
          frame: 0,
          cannonAngle: 0,
          bodyFill: 'red',
          id: 0,
        }
    
    
        for (let i = 0; i < 4; i += 1) {
          //debugger;
          let opts = JSON.parse(JSON.stringify(options));
          opts.position.y += i * 130;
          opts.moveToPos.y += i * 130;
          opts.team = i + 1;
          opts.id+= i;
          let tank = new Tank(ctx, opts);
          tanks.push(tank);
        }
    
    
        canvas.addEventListener('click', (event) => {
          const rect = canvas.getBoundingClientRect();
          const position = { x: event.clientX - rect.left, y: event.clientY - rect.top }
          let isClicked = false;
    
          tanks.forEach((t, index) => {
    
            t.selected = false;
            if (t.checkIfClicked(position)) {
              if (t.team === myTeam) {
    
                // if (index === selectedTankIndex) {
                //   tanks[selectedTankIndex].fireMissile(ctx)
                // }
                selectedTankIndex = index;
                isClicked = true;
    
              }
              else{
                tanks[selectedTankIndex].targetPos =  position;
                tanks[selectedTankIndex].isFiring = true;
                //tanks[selectedTankIndex].addDamage(10);
                //tanks[selectedTankIndex].fireMissileTo(ctx);
                isClicked = true;
              }
            }
    
          
    
    
          });
    
          // Move the selected tank to the clicked point
          if (!isClicked) {
            tanks[selectedTankIndex].moveToPos = position;
            // tanks[selectedTankIndex].fireMissile(ctx);
          }
          tanks[selectedTankIndex].selected = true;
    
    
        });
    
    
        console.log(tanks)
        setInterval(function () {
          //console.time('Game Loop')
          ctx.clearRect(0, 0, canvas.width, canvas.height);
    
        
    
          tanks.forEach((t, index) => {
    
            if(t.isDestroyed){
              tanks.splice(index,1)
            }
        
        
            game.missiles.forEach((missile, index) => {
              if( missile.owner !== t.id && t.detectCollision(missile) && !missile.isExploding){
                missile.isExploding = true;
                t.addDamage(10);
              }
            });
    
            tanks.forEach((tank, tankIndex) => {
              if(tankIndex !== index &&  t.detectCollision(tank) ) {
                t.collide(tank);
                tank.collide(t);
                t.moveToPos = t.position;          
              }
            });
    
            // if (selectedTankIndex > -1 && selectedTankIndex !== index && t.detectCollision(tanks[selectedTankIndex])) {
            //   tanks[selectedTankIndex].moveToPos = tanks[selectedTankIndex].position;
            //   t.collide(tanks[selectedTankIndex]);
            //   tanks[selectedTankIndex].collide(t);
            //   t.moveToPos = t.position;
            // }
    
            t.moveTo();
          });
    
    
          game.missiles.forEach((missile, index) => {
            if( missile.hasExploded ){
              game.missiles.splice(index,1)
            }
            missile.render();
          });
    
    
          game.objects.forEach(obj => {
    
            tanks.forEach((t, index) => {
    
              if (t.detectCollision(obj)) {
                t.collide(obj)
                t.moveToPos = t.position;
              }
            })
            obj.render()
    
            //obj.update(game.missiles)
    
          });
    
    
    
    
    
          //console.timeEnd('Game Loop')
        }, 10);
    
    
        document.getElementById('shoot').onclick = function () {
          //alert('yo')
          tanks[0].fireMissile(ctx);
        }
    
    
    ***************/

  </script>
</body>

</html>